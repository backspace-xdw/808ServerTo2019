# JT808-2019 è½¦è½½ç»ˆç«¯é€šè®¯æœåŠ¡å™¨

> åŸºäº JT/T 808-2019 åè®®æ ‡å‡†çš„é«˜æ€§èƒ½TCPæœåŠ¡å™¨
>
> æ”¯æŒ 10000+ è½¦è½½ç»ˆç«¯å¹¶å‘è¿æ¥
>
> è‡ªåŠ¨è¯†åˆ« 2013 å’Œ 2019 ä¸¤ä¸ªåè®®ç‰ˆæœ¬

---

## ğŸ¯ é¡¹ç›®ç‰¹æ€§

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **åè®®ç‰ˆæœ¬è‡ªåŠ¨è¯†åˆ«** - åŒæ—¶æ”¯æŒJT/T 808-2013å’Œ2019ä¸¤ä¸ªç‰ˆæœ¬
- **é«˜å¹¶å‘æ”¯æŒ** - æ”¯æŒ10000+ç»ˆç«¯åŒæ—¶åœ¨çº¿
- **å®Œæ•´åè®®å®ç°** - ç»ˆç«¯æ³¨å†Œã€é‰´æƒã€å¿ƒè·³ã€ä½ç½®ä¸ŠæŠ¥ç­‰
- **2019ç‰ˆæœ¬æ–°ç‰¹æ€§** - æ‰©å±•æ¶ˆæ¯IDã€10å­—èŠ‚æ‰‹æœºå·ã€IMEIã€è½¯ä»¶ç‰ˆæœ¬ç­‰
- **ä½ç½®é™„åŠ ä¿¡æ¯** - æ”¯æŒé‡Œç¨‹ã€æ²¹é‡ã€ä¿¡å·å¼ºåº¦ç­‰æ‰©å±•ä¿¡æ¯
- **ç²˜åŒ…/åŠåŒ…å¤„ç†** - å®Œå–„çš„æ¶ˆæ¯ç¼“å†²åŒºæœºåˆ¶
- **å¼‚æ­¥é«˜æ€§èƒ½** - åŸºäºSocketAsyncEventArgsçš„é›¶æ‹·è´è®¾è®¡
- **ä¼šè¯ç®¡ç†** - å®Œæ•´çš„ç»ˆç«¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **è¶…æ—¶æ¸…ç†** - è‡ªåŠ¨æ¸…ç†æ— å“åº”çš„ç»ˆç«¯è¿æ¥

### ğŸ“Š 2019ç‰ˆæœ¬ä¸»è¦å˜åŒ–

| é¡¹ç›® | 2013ç‰ˆæœ¬ | 2019ç‰ˆæœ¬ |
|------|---------|---------|
| æ‰‹æœºå·é•¿åº¦ | 6å­—èŠ‚ | 10å­—èŠ‚ |
| åˆ¶é€ å•†ID | 5å­—èŠ‚ | 11å­—èŠ‚ |
| ç»ˆç«¯å‹å· | 20å­—èŠ‚ | 30å­—èŠ‚ |
| ç»ˆç«¯ID | 7å­—èŠ‚ | 30å­—èŠ‚ |
| é‰´æƒæ‰©å±• | ä»…é‰´æƒç  | é‰´æƒç +IMEI+è½¯ä»¶ç‰ˆæœ¬ |
| å‚æ•°ID | 1å­—èŠ‚ | 4å­—èŠ‚ |
| ç‰ˆæœ¬æ ‡è¯† | æ—  | æ¶ˆæ¯ä½“å±æ€§bit14 |
| åè®®ç‰ˆæœ¬å· | æ—  | æ¶ˆæ¯å¤´å¢åŠ 1å­—èŠ‚ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
JT808Server2019/
â”œâ”€â”€ JT808.Protocol/              # åè®®è§£æå±‚
â”‚   â”œâ”€â”€ JT808Constants.cs        # åè®®å¸¸é‡å®šä¹‰ (2019æ‰©å±•)
â”‚   â”œâ”€â”€ JT808Message.cs          # æ¶ˆæ¯æ•°æ®ç»“æ„ (2019æ‰©å±•)
â”‚   â”œâ”€â”€ JT808Decoder.cs          # åè®®è§£ç å™¨ (æ”¯æŒç‰ˆæœ¬è¯†åˆ«)
â”‚   â”œâ”€â”€ JT808Encoder.cs          # åè®®ç¼–ç å™¨ (æ”¯æŒ2019)
â”‚   â”œâ”€â”€ JT808MessageBuffer.cs    # æ¶ˆæ¯ç¼“å†²åŒº(å¤„ç†ç²˜åŒ…)
â”‚   â””â”€â”€ JT808.Protocol.csproj    # é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ JT808.Server/                # æœåŠ¡å™¨å±‚
â”‚   â”œâ”€â”€ JT808TcpServer.cs        # TCPæœåŠ¡å™¨ä¸»ç±»
â”‚   â”œâ”€â”€ SessionManager.cs        # ä¼šè¯ç®¡ç†å™¨ (2019æ‰©å±•)
â”‚   â”œâ”€â”€ Program.cs               # æœåŠ¡å™¨å¯åŠ¨ç¨‹åº
â”‚   â””â”€â”€ JT808.Server.csproj      # é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ JT808.TestClient/            # æµ‹è¯•å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ Program.cs               # æ¨¡æ‹Ÿè½¦è½½ç»ˆç«¯ (æ”¯æŒ2019)
â”‚   â””â”€â”€ JT808.TestClient.csproj  # é¡¹ç›®é…ç½®
â”‚
â”œâ”€â”€ JT808Server2019.sln          # è§£å†³æ–¹æ¡ˆæ–‡ä»¶
â”œâ”€â”€ build.sh                     # ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **.NET 8.0 SDK** æˆ–æ›´é«˜ç‰ˆæœ¬
- Linux / Windows / macOS

### ç¼–è¯‘é¡¹ç›®

```bash
# æ–¹å¼1: ä½¿ç”¨è„šæœ¬
chmod +x build.sh
./build.sh

# æ–¹å¼2: æ‰‹åŠ¨ç¼–è¯‘
dotnet build --configuration Release
```

### è¿è¡ŒæœåŠ¡å™¨

```bash
cd JT808.Server
dotnet run
```

æœåŠ¡å™¨å°†ç›‘å¬ **8809** ç«¯å£ (2019ç‰ˆæœ¬ä½¿ç”¨8809, åŒºåˆ«äº2013ç‰ˆæœ¬çš„8808)

### è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯

åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œ:

```bash
cd JT808.TestClient
dotnet run
```

æŒ‰æç¤ºé€‰æ‹©:
- æœåŠ¡å™¨åœ°å€ (é»˜è®¤127.0.0.1)
- æœåŠ¡å™¨ç«¯å£ (é»˜è®¤8809)
- æ‰‹æœºå· (é»˜è®¤13800138000)
- åè®®ç‰ˆæœ¬ (Y=2019, n=2013)

### æµ‹è¯•æµç¨‹

å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨æ‰§è¡Œ:
1. è¿æ¥æœåŠ¡å™¨
2. å‘é€ç»ˆç«¯æ³¨å†Œ (2019æ‰©å±•å­—æ®µ)
3. æ¥æ”¶é‰´æƒç 
4. å‘é€ç»ˆç«¯é‰´æƒ (åŒ…å«IMEIå’Œè½¯ä»¶ç‰ˆæœ¬)
5. å‘é€ä½ç½®ä¸ŠæŠ¥ (åŒ…å«é™„åŠ ä¿¡æ¯)
6. å‘é€å¿ƒè·³

---

## ğŸ“– åè®®è¯´æ˜

### æ¶ˆæ¯æ ¼å¼ (2019ç‰ˆæœ¬)

```
7E [æ¶ˆæ¯å¤´] [æ¶ˆæ¯ä½“] [æ ¡éªŒç ] 7E
```

### æ¶ˆæ¯å¤´ (2019ç‰ˆæœ¬)

```
[æ¶ˆæ¯ID(2)] [æ¶ˆæ¯ä½“å±æ€§(2)] [åè®®ç‰ˆæœ¬å·(1,å¯é€‰)] [æ‰‹æœºå·(10æˆ–6)] [æµæ°´å·(2)] [åˆ†åŒ…ä¿¡æ¯(4,å¯é€‰)]
```

**æ¶ˆæ¯ä½“å±æ€§ (2019æ–°å¢bit14):**
- bit0-9: æ¶ˆæ¯ä½“é•¿åº¦
- bit10-12: åŠ å¯†æ–¹å¼
- bit13: åˆ†åŒ…æ ‡å¿—
- **bit14: ç‰ˆæœ¬æ ‡è¯† (0=2013, 1=2019)** â¬…ï¸ æ–°å¢
- bit15: ä¿ç•™

### ä½ç½®ä¿¡æ¯ (2019ç‰ˆæœ¬)

åŸºæœ¬ä¿¡æ¯ (28å­—èŠ‚):
```
[æŠ¥è­¦(4)] [çŠ¶æ€(4)] [çº¬åº¦(4)] [ç»åº¦(4)]
[é«˜ç¨‹(2)] [é€Ÿåº¦(2)] [æ–¹å‘(2)] [æ—¶é—´(6)]
```

é™„åŠ ä¿¡æ¯ (å¯å˜é•¿åº¦):
```
[ID(1)] [é•¿åº¦(1)] [å†…å®¹(N)]
...
```

2019ç‰ˆæœ¬æ–°å¢é™„åŠ ä¿¡æ¯ID:
- 0x11: è¶…é€ŸæŠ¥è­¦é™„åŠ ä¿¡æ¯
- 0x12: è¿›å‡ºåŒºåŸŸ/è·¯çº¿æŠ¥è­¦é™„åŠ ä¿¡æ¯
- 0x13: è·¯æ®µè¡Œé©¶æ—¶é—´é™„åŠ ä¿¡æ¯
- 0x25: æ‰©å±•è½¦è¾†ä¿¡å·çŠ¶æ€ä½
- 0x2A: IOçŠ¶æ€ä½
- 0x2B: æ¨¡æ‹Ÿé‡
- 0x30: æ— çº¿é€šä¿¡ç½‘ç»œä¿¡å·å¼ºåº¦
- 0x31: GNSSå®šä½å«æ˜Ÿæ•°

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ç‰ˆæœ¬è‡ªåŠ¨è¯†åˆ«

```csharp
// æ£€æµ‹æ¶ˆæ¯ä½“å±æ€§bit14
public bool Is2019Version => (MessageBodyProperty & 0x4000) != 0;

// æ ¹æ®ç‰ˆæœ¬è¯»å–ä¸åŒé•¿åº¦çš„æ‰‹æœºå·
int phoneLength = is2019 ? 10 : 6;
```

### 2. ç»ˆç«¯æ³¨å†Œ (2019æ‰©å±•)

```csharp
// 2019ç‰ˆæœ¬å­—æ®µé•¿åº¦æ‰©å±•
ManufacturerId: 11å­—èŠ‚ (2013: 5å­—èŠ‚)
TerminalModel: 30å­—èŠ‚  (2013: 20å­—èŠ‚)
TerminalId: 30å­—èŠ‚     (2013: 7å­—èŠ‚)
```

### 3. ç»ˆç«¯é‰´æƒ (2019æ‰©å±•)

```csharp
// 2019æ–°å¢å­—æ®µ
AuthCodeLength: 1å­—èŠ‚  // é‰´æƒç é•¿åº¦
AuthCode: å¯å˜é•¿åº¦     // é‰´æƒç 
IMEI: 15å­—èŠ‚           // ç»ˆç«¯IMEI (æ–°å¢)
SoftwareVersion: 20å­—èŠ‚ // è½¯ä»¶ç‰ˆæœ¬ (æ–°å¢)
```

### 4. ä½ç½®é™„åŠ ä¿¡æ¯è§£æ

```csharp
while (offset < body.Length)
{
    byte id = body[offset++];
    byte length = body[offset++];
    byte[] content = new byte[length];
    Array.Copy(body, offset, content, 0, length);
    offset += length;

    // æ ¹æ®IDè§£æä¸åŒç±»å‹çš„é™„åŠ ä¿¡æ¯
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¹¶å‘è¿æ¥**: 10000+
- **æ¶ˆæ¯å¤„ç†**: å¼‚æ­¥é«˜æ€§èƒ½
- **å†…å­˜ä¼˜åŒ–**: é›¶æ‹·è´è®¾è®¡
- **CPUä¼˜åŒ–**: å¼‚æ­¥IOé¿å…çº¿ç¨‹å¼€é”€
- **åè®®å…¼å®¹**: è‡ªåŠ¨è¯†åˆ«2013/2019ç‰ˆæœ¬

---

## ğŸ›ï¸ é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®

```csharp
// Program.cs
var server = new JT808TcpServer(
    logger,
    port: 8809,      // ç›‘å¬ç«¯å£
    backlog: 10000   // æœ€å¤§è¿æ¥é˜Ÿåˆ—
);
```

### è¶…æ—¶é…ç½®

```csharp
// SessionManager.cs
CleanupTimeoutSessions(timeoutMinutes: 30); // 30åˆ†é’Ÿæ— æ´»åŠ¨åˆ™æ–­å¼€
```

---

## ğŸ“ æ¶ˆæ¯ç±»å‹æ”¯æŒ

### ç»ˆç«¯é€šç”¨æ¶ˆæ¯
- âœ… 0x0001 ç»ˆç«¯é€šç”¨åº”ç­”
- âœ… 0x8001 å¹³å°é€šç”¨åº”ç­”
- âœ… 0x0002 ç»ˆç«¯å¿ƒè·³
- âœ… 0x0100 ç»ˆç«¯æ³¨å†Œ (2019æ‰©å±•)
- âœ… 0x8100 ç»ˆç«¯æ³¨å†Œåº”ç­”
- âœ… 0x0003 ç»ˆç«¯æ³¨é”€
- âœ… 0x0102 ç»ˆç«¯é‰´æƒ (2019æ‰©å±•)

### ä½ç½®ä¿¡æ¯
- âœ… 0x0200 ä½ç½®ä¿¡æ¯æ±‡æŠ¥ (æ”¯æŒé™„åŠ ä¿¡æ¯)
- âœ… 0x0704 å®šä½æ•°æ®æ‰¹é‡ä¸Šä¼ 
- â³ 0x8201 ä½ç½®ä¿¡æ¯æŸ¥è¯¢
- â³ 0x8202 ä¸´æ—¶ä½ç½®è·Ÿè¸ªæ§åˆ¶

### ä¿¡æ¯æœåŠ¡
- â³ 0x8300 æ–‡æœ¬ä¿¡æ¯ä¸‹å‘
- â³ 0x8302 æé—®ä¸‹å‘
- â³ 0x8303 ä¿¡æ¯ç‚¹æ’­èœå•è®¾ç½®

### å¤šåª’ä½“ (2019æ–°å¢)
- â³ 0x0801 å¤šåª’ä½“æ•°æ®ä¸Šä¼ 
- â³ 0x8801 æ‘„åƒå¤´ç«‹å³æ‹æ‘„å‘½ä»¤
- â³ 0x8802 å­˜å‚¨å¤šåª’ä½“æ•°æ®æ£€ç´¢

---

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

è¿è¡ŒæœåŠ¡å™¨å,æŒ‰ä»»æ„é”®æŸ¥çœ‹:
- åœ¨çº¿ç»ˆç«¯æ•°
- å·²é‰´æƒç»ˆç«¯æ•°
- 2019/2013ç‰ˆæœ¬åˆ†å¸ƒ
- ç»ˆç«¯è¯¦ç»†ä¿¡æ¯ (æ‰‹æœºå·ã€IMEIã€ç‰ˆæœ¬ç­‰)

### æ—¥å¿—çº§åˆ«

```csharp
builder.SetMinimumLevel(LogLevel.Information);
// å¯é€‰: Debug, Information, Warning, Error
```

---

## ğŸ› ï¸ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°æ¶ˆæ¯ç±»å‹

1. åœ¨ `JT808Constants.cs` æ·»åŠ æ¶ˆæ¯ID
2. åœ¨ `JT808Message.cs` æ·»åŠ æ•°æ®ç»“æ„
3. åœ¨ `JT808Decoder.cs` æ·»åŠ è§£ææ–¹æ³•
4. åœ¨ `JT808Encoder.cs` æ·»åŠ ç¼–ç æ–¹æ³•
5. åœ¨ `JT808TcpServer.cs` çš„ `ProcessMessage` æ·»åŠ å¤„ç†é€»è¾‘

### æ•°æ®åº“é›†æˆ

å»ºè®®é›†æˆ:
- PostgreSQL / MySQL (å­˜å‚¨ä½ç½®ã€è½¦è¾†ä¿¡æ¯)
- Redis (ç¼“å­˜åœ¨çº¿ç»ˆç«¯ã€é‰´æƒç )
- InfluxDB (æ—¶åºä½ç½®æ•°æ®)

---

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### Dockeréƒ¨ç½²

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY . .
RUN dotnet publish JT808.Server/JT808.Server.csproj -c Release -o /app

FROM mcr.microsoft.com/dotnet/runtime:8.0
WORKDIR /app
COPY --from=build /app .
EXPOSE 8809
ENTRYPOINT ["dotnet", "JT808.Server.dll"]
```

### è´Ÿè½½å‡è¡¡

```nginx
stream {
    upstream jt808_backend {
        server 192.168.1.10:8809;
        server 192.168.1.11:8809;
        server 192.168.1.12:8809;
    }

    server {
        listen 8809;
        proxy_pass jt808_backend;
    }
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **JT/T 808-2013** é“è·¯è¿è¾“è½¦è¾†å«æ˜Ÿå®šä½ç³»ç»Ÿç»ˆç«¯é€šè®¯åè®®åŠæ•°æ®æ ¼å¼
- **JT/T 808-2019** é“è·¯è¿è¾“è½¦è¾†å«æ˜Ÿå®šä½ç³»ç»Ÿç»ˆç«¯é€šè®¯åè®®åŠæ•°æ®æ ¼å¼ (ä¿®è®¢ç‰ˆ)
- **GB/T 19056** æ±½è½¦è¡Œé©¶è®°å½•ä»ª

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Request!

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## âœ¨ å…³é”®æ”¹è¿›ç‚¹ (vs 2013ç‰ˆæœ¬)

1. âœ… **åè®®ç‰ˆæœ¬è‡ªåŠ¨è¯†åˆ«** - åŒæ—¶æ”¯æŒæ–°æ—§åè®®
2. âœ… **æ‰‹æœºå·æ‰©å±•** - æ”¯æŒ10å­—èŠ‚æ‰‹æœºå·
3. âœ… **æ³¨å†Œä¿¡æ¯æ‰©å±•** - æ›´é•¿çš„åˆ¶é€ å•†IDã€å‹å·ã€ç»ˆç«¯ID
4. âœ… **é‰´æƒä¿¡æ¯æ‰©å±•** - IMEIã€è½¯ä»¶ç‰ˆæœ¬
5. âœ… **ä½ç½®é™„åŠ ä¿¡æ¯** - é‡Œç¨‹ã€æ²¹é‡ã€ä¿¡å·å¼ºåº¦ç­‰
6. âœ… **æ›´å¤šæ¶ˆæ¯ç±»å‹** - å¤šåª’ä½“ã€æ•°æ®å‹ç¼©ç­‰
7. âœ… **å‘åå…¼å®¹** - 2013ç‰ˆæœ¬å®¢æˆ·ç«¯å¯æ­£å¸¸è¿æ¥

---

**é¡¹ç›®å®Œæˆ! å¼€å§‹æ‚¨çš„JT808-2019æœåŠ¡å™¨ä¹‹æ—…!** ğŸš€
